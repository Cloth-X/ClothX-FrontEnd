<app-navbar></app-navbar>

<ngb-tabset id="tab" [justify]="'start'">
  <ngb-tab title="Billing">
    <ng-template ngbTabContent>

      <div class="page">
        <div class=" qr-scanner-preview">
          <div class="card">
            <app-qr-scanner (product)="getProduct($event)"></app-qr-scanner>
          </div>
        </div>


        <div class="container">
          <a class="float-right" style="cursor: pointer" (click)="reset()"><i class="material-icons">refresh</i> </a>
          <h3>Create invoice</h3>

          <ngb-alert [dismissible]="true" *ngIf="isErrorInSavingInvoice" (close)="isErrorInSavingInvoice = false"
                     [type]="'danger'">
            <p
              *ngIf="!(invoice.customerNumber.toString().indexOf('') === 0
      && invoice.customerNumber.toString().length === 10)"
            > You can't sent invoice without customer phone number.</p>
            <p *ngIf="!(cartProducts.length > 0)">You can't sent invoice without products.</p>
            <p *ngIf="outStockedProducts.length > 0">You can't sent invoice with out of stock products.</p>
          </ngb-alert>

          <div class="form-group">
            <label for="customer-number">Customer number :</label>
            <h6 class="float-right"><span class="badge "
                                          [ngClass]="invoice.typeOfPayment == payment?'badge-primary': 'badge-light'"
                                          (click)="selectPayment(payment)"
                                          *ngFor="let payment of typeOfPayment">{{payment}}</span></h6>
            <div class="input-group">
              <input type="number" class="form-control form-control-md " id="customer-number" placeholder="Phone number"
                     required
                     [(ngModel)]="invoice.customerNumber">
            </div>
            <div>
              <small class="form-text text-info">
                Phone number is required.
              </small>
            </div>
          </div>

          <div class="form-group">
            <label for="add-cart">Product Id :</label>
            <div class="input-group">
              <input type="text" class="form-control form-control-md " id="add-cart" aria-describedby="button-addon4"
                     placeholder="Product reference number (PRN)"
                     [(ngModel)]="prn" [ngbTypeahead]="prnSearch" (keyup.enter)="addToCart(prn)">
              <div class="input-group-append" id="button-addon4">
                <button class="btn btn-primary" type="button" (click)="addToCart(prn)">Add</button>
              </div>
            </div>
          </div>

          <div class="grid-wrapper" *ngIf="!(cartProducts.length > 0)">
            <div class="card">

              <img src="../../assets/logo/logo.png" class="grey-icon" alt="">
              <div class="content">There is no product added to cart yet</div>
            </div>
          </div>
          <div class="item-wrapper" *ngIf="cartProducts.length > 0">
            <div class="item" *ngFor="let product of cartProducts; let i = index">
              <a class="menu float-right" (click)="deleteProductFromCart(i)"><i class="material-icons">delete</i> </a>
              <h5>{{ product.productName }}</h5>
              <h6>{{product.prn}}</h6>
              <span class="badge search-option"
                    [ngClass]="product.selectedSize === i?'badge-primary': 'badge-light'"
                    (click)="selectSize(product, i)"
                    *ngFor="let differentSize of product.variants;let i = index">
          {{differentSize.size}}
        </span>

              <div class="form-group">
                <label for="total-quantity">Quantity</label>
                <div class="input-group">
                  <input type="number" class="form-control form-control-md " id="total-quantity"
                         [(ngModel)]="product.totalQuantity " (ngModelChange)="calculateTotal(product)">
                </div>
                <p *ngIf="!product.totalQuantity">Quantity of the product can't be zero</p>
                <p *ngIf="product.isOutStock">Out of stock</p>
              </div>
              <h6>Price: &#8377; {{product.totalPrice}}</h6>
            </div>

          </div>

        </div>
      </div>

      <nav class="bg-dark text-white navbar toolbar ">
        <div class=" total-detail">
          <a>TQ: {{invoice.totalQuantity}}</a>
          <a>Total Price: &#8377; {{invoice.totalPrice}}</a>
          <!--<a>Total Tax: &#8377; {{invoice.totalTax}}</a>-->
        </div>
        <div>

          <!--<a class="icon-button" (click)="saveInvoice()"> <i class="material-icons">save_alt</i></a>-->
          <a class="icon-button" (click)="saveInvoice()"> <i class="material-icons">save_alt</i></a>
        </div>
      </nav>


    </ng-template>
  </ngb-tab>
  <ngb-tab>
    <ng-template ngbTabTitle>Return</ng-template>
    <ng-template ngbTabContent>
      <app-return-products></app-return-products>
    </ng-template>
  </ngb-tab>

</ngb-tabset>
